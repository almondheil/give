<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Give: give-assist.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>give-assist.c File Reference</h1><code>#include &quot;./config.h&quot;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;sys/param.h&gt;</code><br>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;pwd.h&gt;</code><br>
<code>#include &lt;grp.h&gt;</code><br>
<code>#include &lt;sys/stat.h&gt;</code><br>
<code>#include &quot;./string_m/string_m.h&quot;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;dirent.h&gt;</code><br>
<code>#include &lt;paths.h&gt;</code><br>
<code>#include &lt;sys/ptrace.h&gt;</code><br>
<code>#include &lt;sys/time.h&gt;</code><br>
<code>#include &lt;sys/resource.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;sys/wait.h&gt;</code><br>
<code>#include &lt;wchar.h&gt;</code><br>
<code>#include &lt;limits.h&gt;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#3cac9fa09cb0e1397aa82d98623a8c41">_BSD_SOURCE</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#d5f93e075170573ba1fd0b0d71a0838b">_POSIX_SOURCE</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#6a370c88aa74f693eec7edf0d564a770">ACCEPTABLE_CHARS</a>&nbsp;&nbsp;&nbsp;&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#805058b9359d9288f75c8875c0bf101f">GA_VERSION</a>&nbsp;&nbsp;&nbsp;&quot;give-assist 3.0n&quot;</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#61ccd8ad12c72a597ad91f4aeb7ca243">try_m</a> (errno_t result)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#beda442b4e0231438428a94c39fc29c4">try_err</a> (errno_t result, char *err)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#94576c6ee9e96434d9c7580061842813">die_err_zs</a> (char *zs, errno_t err)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#a538e0e88ea4b4308ce3f4511861a989">die_2zs</a> (char *a, char *b)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#29a7f02d1800e85b8ccb0dad06aa5dc5">die_zs</a> (char *zs)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#aa0de4d2f14b6add55166ed61a0ae6e2">gt_access_ok</a> (struct passwd *g, struct passwd *t)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#1dc0e2f164dfc8675b1f8819b9c90791">give_spool_ok</a> (char *spooldir)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#d99bbade2f79c2bf0517fc6a663654c6">taker_group_ok</a> (struct passwd *t)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#683a67f2a218cd89602de28e762e444b">safe_mkdir_m</a> (string_m s, mode_t mode, uid_t u, gid_t g)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#a57acc7e37c06b068bef5aafe3a35767">emit</a> (char *a, string_m s, char *b)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#8bd5efd546d4b3015211b5bf269f4d3d">check_for_debuggers</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#a1249936e79c7a2f43689fb7b445265f">ignore_signals</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#852a19f82e75df9896ce21a47b99c11c">sanitize_fds</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#1eab4853cf6b2fb9b57fa163699921eb">limit_cores</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#13cfc0704743ba634de0301d358cac98">open_devnull</a> (int fd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#24e6ce6d053864cf5fb7af941457bb0e">main</a> (int argc, char **argv)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#073218c7ebc61af2287e11a1435f3b6d">scanfor</a> (char *s, char **a)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#ee1471bb0dc0b12f9311a3e436442b64">onlycontains</a> (char *s, char **a)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static const bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="give-assist_8c.html#86fbda2979dea24daa64a0764d2c48c1">debug</a> = false</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
give-assist- create secure directories for file exchange 2010-08-27 Shawn Instenes &lt;<a href="mailto:shawni@llnl.gov">shawni@llnl.gov</a>&gt;<p>
2012-07 Re-Write for LANL enviornment Jon Bringhurst and Dominic Manno <dl compact><dt><b>Author:</b></dt><dd>: Shawn Instenes <p>
: Trent D'Hooge <p>
: Jim Garlick <p>
: Jon Bringhurst <p>
: Dominic Manno <p>
: Ryan Day</dd></dl>
This program assists the give program to create a secure directory structure for the exchange of files, with some local assumptions:<p>
1. each user has a group with the same gid as their uid, and they are the only member.<p>
2. both the giver and the taker usernames can be looked up with getpwent()<p>
For LLNL convienience, a group named "gt-&lt;taker_uid&gt;" may exist. If it does, then the giver must be a member of that group or the program will not continue. (This is also checked in the "give" program.)<p>
The give spool directory structure is:<p>
SPOOL_ROOT/TAKER_UNAME/GIVER_UNAME/GIVEN_FILENAME<p>
Where:<p>
SPOOL = top level spool directory, owned by root, mode 0755.<p>
TAKER_UNAME = taker's username, owned taker_uid:taker_gid, mode 0711.*<p>
GIVER_UNAME = giver's username, owned giver_uid:taker_gid, mode 0770.<p>
GIVEN_FILENAME = any file, owned giver_uid:giver_gid, mode 0X44 where X is the original owner permission bits. The perms on the directories are defined this way because the taker needs to own their givedir, the giver needs to own the subdir for which they have given to the taker (for ungive), but the taker's gid group also owns this because the taker needs to acess it as well (to take).<p>
Goals:<p>
A) Files given are owned by giver until taken (for quota purposes)<p>
B) Filenames are private to giver/taker (ignoring root, of course)<p>
C) Files may be given and taken without special privledges from giver to taker after this program has run at least once.<p>
This program checks return codes from everything, and dies if anything goes wrong. <hr><h2>Define Documentation</h2>
<a class="anchor" name="3cac9fa09cb0e1397aa82d98623a8c41"></a><!-- doxytag: member="give-assist.c::_BSD_SOURCE" ref="3cac9fa09cb0e1397aa82d98623a8c41" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _BSD_SOURCE          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="d5f93e075170573ba1fd0b0d71a0838b"></a><!-- doxytag: member="give-assist.c::_POSIX_SOURCE" ref="d5f93e075170573ba1fd0b0d71a0838b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _POSIX_SOURCE          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="6a370c88aa74f693eec7edf0d564a770"></a><!-- doxytag: member="give-assist.c::ACCEPTABLE_CHARS" ref="6a370c88aa74f693eec7edf0d564a770" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ACCEPTABLE_CHARS&nbsp;&nbsp;&nbsp;&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="805058b9359d9288f75c8875c0bf101f"></a><!-- doxytag: member="give-assist.c::GA_VERSION" ref="805058b9359d9288f75c8875c0bf101f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GA_VERSION&nbsp;&nbsp;&nbsp;&quot;give-assist 3.0n&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="8bd5efd546d4b3015211b5bf269f4d3d"></a><!-- doxytag: member="give-assist.c::check_for_debuggers" ref="8bd5efd546d4b3015211b5bf269f4d3d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int check_for_debuggers           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check for debuggers, try to ignore them<p>
<dl compact><dt><b>Returns:</b></dt><dd>int status of debugger check </dd></dl>

</div>
</div><p>
<a class="anchor" name="a538e0e88ea4b4308ce3f4511861a989"></a><!-- doxytag: member="give-assist.c::die_2zs" ref="a538e0e88ea4b4308ce3f4511861a989" args="(char *a, char *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void die_2zs           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
abort program print two messages to stderr<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>string message to print to stderr </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>string second message to print to stderr </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="94576c6ee9e96434d9c7580061842813"></a><!-- doxytag: member="give-assist.c::die_err_zs" ref="94576c6ee9e96434d9c7580061842813" args="(char *zs, errno_t err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void die_err_zs           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>zs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">errno_t&nbsp;</td>
          <td class="paramname"> <em>err</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<a class="el" href="give-assist_8c.html#94576c6ee9e96434d9c7580061842813">die_err_zs()</a>- abort program if any managed string assertion fails, print msg and error number to stderr<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>zs</em>&nbsp;</td><td>string message to print </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>err</em>&nbsp;</td><td>errno_t error number obtained from function call that failed </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="29a7f02d1800e85b8ccb0dad06aa5dc5"></a><!-- doxytag: member="give-assist.c::die_zs" ref="29a7f02d1800e85b8ccb0dad06aa5dc5" args="(char *zs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void die_zs           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>zs</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
abort program print one message to stderr<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>zs</em>&nbsp;</td><td>string message to be printed to stderr </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a57acc7e37c06b068bef5aafe3a35767"></a><!-- doxytag: member="give-assist.c::emit" ref="a57acc7e37c06b068bef5aafe3a35767" args="(char *a, string_m s, char *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void emit           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string_m&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
print a managed string, possibly with fore &amp; after ie. print a managed string between two unmanaged ones<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>string already ready to be printed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>string_m managed string to be printed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>string already ready to be printed </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="1dc0e2f164dfc8675b1f8819b9c90791"></a><!-- doxytag: member="give-assist.c::give_spool_ok" ref="1dc0e2f164dfc8675b1f8819b9c90791" args="(char *spooldir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool give_spool_ok           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>spooldir</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<a class="el" href="give-assist_8c.html#1dc0e2f164dfc8675b1f8819b9c90791">give_spool_ok()</a>- make sure spool directory: 1) exist 2) owned by root 3) be a directory 4) is mode 755<p>
This eliminates some potential security holes with our chown() calls and race conditions, if the spool directory were otherwise writable by someone other than root.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spooldir</em>&nbsp;</td><td>string the SPOOL which represents the givedir </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>if the givedir passes the checks described above </dd></dl>

</div>
</div><p>
<a class="anchor" name="aa0de4d2f14b6add55166ed61a0ae6e2"></a><!-- doxytag: member="give-assist.c::gt_access_ok" ref="aa0de4d2f14b6add55166ed61a0ae6e2" args="(struct passwd *g, struct passwd *t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool gt_access_ok           </td>
          <td>(</td>
          <td class="paramtype">struct passwd *&nbsp;</td>
          <td class="paramname"> <em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct passwd *&nbsp;</td>
          <td class="paramname"> <em>t</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This is implemented for LLNL...and IS necessary It keeps control over which users can give/take with eachother...for classified clusters<p>
If a group named "gt-&lt;taker-uid-in-decimal&gt;" exists, then the giver must be a member or the operation will be denied. If the group does not exist then the operation is OK.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>g</em>&nbsp;</td><td>struct passwd* giver </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>t</em>&nbsp;</td><td>struct passwd* taker </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a1249936e79c7a2f43689fb7b445265f"></a><!-- doxytag: member="give-assist.c::ignore_signals" ref="a1249936e79c7a2f43689fb7b445265f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ignore_signals           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
ignore signals 
</div>
</div><p>
<a class="anchor" name="1eab4853cf6b2fb9b57fa163699921eb"></a><!-- doxytag: member="give-assist.c::limit_cores" ref="1eab4853cf6b2fb9b57fa163699921eb" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void limit_cores           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Disable memory dumps 
</div>
</div><p>
<a class="anchor" name="24e6ce6d053864cf5fb7af941457bb0e"></a><!-- doxytag: member="give-assist.c::main" ref="24e6ce6d053864cf5fb7af941457bb0e" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="ee1471bb0dc0b12f9311a3e436442b64"></a><!-- doxytag: member="give-assist.c::onlycontains" ref="ee1471bb0dc0b12f9311a3e436442b64" args="(char *s, char **a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool onlycontains           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
see if s is the only item in a[] this makes sure that the user is the only member of his/her uid group, this should be tree in all cases<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>string username </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>array(char**) the array that holds the members of the group </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="13cfc0704743ba634de0301d358cac98"></a><!-- doxytag: member="give-assist.c::open_devnull" ref="13cfc0704743ba634de0301d358cac98" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int open_devnull           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
helper with closing all open files, reopens stdin, stdout, and stderr <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fd</em>&nbsp;</td><td>integer </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>integer to determine success or fail </dd></dl>

</div>
</div><p>
<a class="anchor" name="683a67f2a218cd89602de28e762e444b"></a><!-- doxytag: member="give-assist.c::safe_mkdir_m" ref="683a67f2a218cd89602de28e762e444b" args="(string_m s, mode_t mode, uid_t u, gid_t g)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void safe_mkdir_m           </td>
          <td>(</td>
          <td class="paramtype">string_m&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uid_t&nbsp;</td>
          <td class="paramname"> <em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gid_t&nbsp;</td>
          <td class="paramname"> <em>g</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<a class="el" href="give-assist_8c.html#683a67f2a218cd89602de28e762e444b">safe_mkdir_m()</a>-<p>
Make a directory (it may already exist), and make sure it ends up with the correct ownership and permissions<p>
This code is intended to work within a managed directory tree- the topmost directory should be owned by root and writable only by root<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>string_m pathname </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>mode_t mode of directory </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>u</em>&nbsp;</td><td>uid_t user id </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>g</em>&nbsp;</td><td>gid_t group id from /etc/passwd file </td></tr>
  </table>
</dl>

<p>
may seem funny here, but directory needs to be owned by giver:taker_gid, so that both have acess to this 
</div>
</div><p>
<a class="anchor" name="852a19f82e75df9896ce21a47b99c11c"></a><!-- doxytag: member="give-assist.c::sanitize_fds" ref="852a19f82e75df9896ce21a47b99c11c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sanitize_fds           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Close all open files, also calls open_devnull to reopen stdin, stdout, stderr 
</div>
</div><p>
<a class="anchor" name="073218c7ebc61af2287e11a1435f3b6d"></a><!-- doxytag: member="give-assist.c::scanfor" ref="073218c7ebc61af2287e11a1435f3b6d" args="(char *s, char **a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool scanfor           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
check to see if a string is a member of the array a in the case where it is called, it is checking to be sure that the user is a member of the group, this is called from gt_access so in that case there could be multiple members of the group<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>string user </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>array(char **) group members </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="d99bbade2f79c2bf0517fc6a663654c6"></a><!-- doxytag: member="give-assist.c::taker_group_ok" ref="d99bbade2f79c2bf0517fc6a663654c6" args="(struct passwd *t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool taker_group_ok           </td>
          <td>(</td>
          <td class="paramtype">struct passwd *&nbsp;</td>
          <td class="paramname"> <em>t</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
taker_group_ok will check to see if taker is in a valid group and is the only member of the group it checks the uid group, so yes they should be the only member<p>
this also checks the /etc/grp file to see if group(uid) exists (access_grp = getgrnam(username)) if it does, it then checks to be sure that there is only one member<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>t</em>&nbsp;</td><td>struct passwd* taker </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="beda442b4e0231438428a94c39fc29c4"></a><!-- doxytag: member="give-assist.c::try_err" ref="beda442b4e0231438428a94c39fc29c4" args="(errno_t result, char *err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void try_err           </td>
          <td>(</td>
          <td class="paramtype">errno_t&nbsp;</td>
          <td class="paramname"> <em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>err</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<a class="el" href="give-assist_8c.html#beda442b4e0231438428a94c39fc29c4">try_err()</a>- abort program if any managed string assertion fails, include error. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>result</em>&nbsp;</td><td>errno_t return value of the function being called before try_m, if no errors result == 0 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>err</em>&nbsp;</td><td>string error msg </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="61ccd8ad12c72a597ad91f4aeb7ca243"></a><!-- doxytag: member="give-assist.c::try_m" ref="61ccd8ad12c72a597ad91f4aeb7ca243" args="(errno_t result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void try_m           </td>
          <td>(</td>
          <td class="paramtype">errno_t&nbsp;</td>
          <td class="paramname"> <em>result</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<a class="el" href="give-assist_8c.html#61ccd8ad12c72a597ad91f4aeb7ca243">try_m()</a>- abort program if any managed string assertion fails. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>result</em>&nbsp;</td><td>errno_t the return value of the function being called before try_m, if no errors result == 0 </td></tr>
  </table>
</dl>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="86fbda2979dea24daa64a0764d2c48c1"></a><!-- doxytag: member="give-assist.c::debug" ref="86fbda2979dea24daa64a0764d2c48c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const bool <a class="el" href="give-assist_8c.html#86fbda2979dea24daa64a0764d2c48c1">debug</a> = false<code> [static]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Tue Aug 14 12:49:31 2012 for Give by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
